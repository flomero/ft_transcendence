<h2>Chat!</h2>

<div id="chat-container" class="grid grid-cols-4 gap-4 w-full">
    <div id="chat-rooms" class="col-span-1">
        {{#each rooms}}
            {{> components/chat/room room=this}}
        {{/each}}
    </div>
    {{> components/chat/messages messages=messages}}
    <form id="chat-input" class="col-span-4" onsubmit="sendMessage(event)" method="POST">
        <input type="text" required name="message" placeholder="Message...">
        {{#> components/button}}Send{{/components/button}}
    </form>
</div>

<style>
    .chat-message {
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 8px;
        max-width: 70%;
    }
    
    .chat-message-own {
        background-color: #DCF8C6;
        margin-left: auto;
        margin-right: 10px;
    }
    
    .chat-message-other {
        background-color: #F2F2F2;
        margin-right: auto;
        margin-left: 10px;
    }
    
    .chat-message-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        font-size: 0.8rem;
    }
    
    .chat-message-username {
        font-weight: bold;
        color: #555;
    }
    
    .chat-message-time {
        color: #999;
    }
    
    .chat-message-content {
        word-wrap: break-word;
    }
</style>

<script>
    const currentUrl = window.location.origin;
    const wsProtocol = currentUrl.startsWith('https') ? 'wss' : 'ws';
    const wsUrl = currentUrl.replace(/^http/, 'ws');
    const socket = new WebSocket(`${wsUrl}/chat/ws`);

    socket.onmessage = function (event) {
        const data = JSON.parse(event.data);
        const messageContainer = document.getElementById('chat-messages');
        messageContainer.innerHTML += data.html;
    }

    function sendMessage(event) {
        event.preventDefault();
        const message = event.target.message.value;
        if (message.trim() === '') {
            return;
        }
        socket.send(message);
        event.target.reset();
    }

    function selectRoom(event) {
        const clickedRoom = event.target;
        
        if (!roomElement) {
            return;
        }

        const roomId = clickedRoom.getAttribute('data-room-id');

    }
</script>