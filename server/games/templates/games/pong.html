<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pong Game</title>
    <style>
      body {
        text-align: center;
        background-color: black;
        color: white;
      }
      #game-container {
        width: 600px;
        height: 300px;
        border: 2px solid white;
        position: relative;
        margin: auto;
      }
      .paddle {
        width: 10px;
        height: 60px;
        background: white;
        position: absolute;
      }
      .ball {
        width: 10px;
        height: 10px;
        background: white;
        position: absolute;
      }
      #paddle-left {
        left: 5px;
      }
      #paddle-right {
        right: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Pong Game</h1>
    <div id="game-container">
      <div id="paddle-left" class="paddle"></div>
      <div id="paddle-right" class="paddle"></div>
      <div id="ball" class="ball"></div>
    </div>

    <script>
      const socket = new WebSocket("ws://127.0.0.1:8000/ws/game/");

      socket.onopen = function () {
        console.log("âœ… WebSocket connected");
        socket.send(
          JSON.stringify({
            game: "pong",
            game_mode: "default_pong",
            modifiers: [],
            start_game: true,
          })
        );
      };

      socket.onmessage = function (event) {
        const gameState = JSON.parse(event.data);

        // Update ball position
        document.getElementById("ball").style.left = gameState.ball.x + "%";
        document.getElementById("ball").style.top = gameState.ball.y + "%";

        // Update paddle positions
        if (gameState.paddles.left) {
          document.getElementById("paddle-left").style.top =
            gameState.paddles.left.y + "%";
        }
        if (gameState.paddles.right) {
          document.getElementById("paddle-right").style.top =
            gameState.paddles.right.y + "%";
        }
      };

      socket.onclose = function () {
        console.log("ðŸ”´ WebSocket Closed");
      };

      document.addEventListener("keydown", (event) => {
        let action = null;
        if (event.key === "ArrowUp") action = "RIGHT_UP";
        if (event.key === "ArrowDown") action = "RIGHT_DOWN";
        if (event.key === "w") action = "LEFT_UP";
        if (event.key === "s") action = "LEFT_DOWN";

        if (action) {
          socket.send(JSON.stringify({ action }));
        }
      });
    </script>
  </body>
</html>
